# é”™è¯¯ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯**ï¼š`Type 'String' does not conform to protocol 'Error'`

**åŸå› **ï¼šåœ¨Swiftä¸­ï¼Œ`Result<Success, Failure>` ç±»å‹è¦æ±‚ `Failure` å¿…é¡»éµå¾ª `Error` åè®®ï¼Œä½†ä»£ç ä¸­ä½¿ç”¨äº† `Result<Void, String>`ï¼Œè€Œ `String` ä¸éµå¾ª `Error` åè®®ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯ç±»å‹

æ–°å»ºæ–‡ä»¶ï¼š`PPRoom/Models/RoomError.swift`

```swift
enum RoomError: Error {
    case permissionDenied(String)   // æƒé™è¢«æ‹’ç»
    case operationFailed(String)    // æ“ä½œå¤±è´¥
    case invalidState(String)       // æ— æ•ˆçŠ¶æ€
    case invalidInput(String)       // æ— æ•ˆè¾“å…¥
    
    var localizedDescription: String {
        switch self {
        case .permissionDenied(let message): return message
        case .operationFailed(let message): return message
        case .invalidState(let message): return message
        case .invalidInput(let message): return message
        }
    }
}
```

### 2. ä¿®æ”¹è¿”å›ç±»å‹

å°†æ‰€æœ‰æ–¹æ³•çš„è¿”å›ç±»å‹ä» `Result<Void, String>` æ”¹ä¸º `Result<Void, RoomError>`

**ä¿®æ”¹çš„æ–‡ä»¶**ï¼š
- `RoomManager.swift` - æ‰€æœ‰è¿”å› Result çš„æ–¹æ³•
- `ViewController.swift` - handleResult æ–¹æ³•
- `PermissionTests.swift` - æ‰€æœ‰æµ‹è¯•æ–¹æ³•å’Œæ–­è¨€

### 3. ä¿®æ”¹é”™è¯¯åˆ›å»ºæ–¹å¼

**ä¿®æ”¹å‰**ï¼š
```swift
return .failure("æƒé™ä¸è¶³")
```

**ä¿®æ”¹å**ï¼š
```swift
return .failure(.permissionDenied("æƒé™ä¸è¶³"))
```

### 4. ä¿®æ”¹é”™è¯¯å¤„ç†æ–¹å¼

**ä¿®æ”¹å‰**ï¼š
```swift
case .failure(let error):
    print("é”™è¯¯ï¼š\(error)")
```

**ä¿®æ”¹å**ï¼š
```swift
case .failure(let error):
    print("é”™è¯¯ï¼š\(error.localizedDescription)")
```

## ğŸ“Š ä¿®æ”¹ç»Ÿè®¡

### ä¿®æ”¹çš„æ–‡ä»¶

1. **æ–°å¢æ–‡ä»¶**ï¼ˆ1ä¸ªï¼‰
   - `PPRoom/Models/RoomError.swift`

2. **ä¿®æ”¹æ–‡ä»¶**ï¼ˆ3ä¸ªï¼‰
   - `PPRoom/Manager/RoomManager.swift`
     - ä¿®æ”¹äº† 8 ä¸ªæ–¹æ³•çš„è¿”å›ç±»å‹
     - ä¿®æ”¹äº†æ‰€æœ‰çš„é”™è¯¯è¿”å›è¯­å¥
   
   - `PPRoom/ViewController.swift`
     - ä¿®æ”¹äº† `handleResult` æ–¹æ³•çš„å‚æ•°ç±»å‹
   
   - `PPRoom/Tests/PermissionTests.swift`
     - ä¿®æ”¹äº† `assert` è¾…åŠ©æ–¹æ³•
     - ä¿®æ”¹äº†æ‰€æœ‰æµ‹è¯•åœºæ™¯ä¸­çš„é”™è¯¯å¤„ç†

### ä¿®æ”¹çš„æ–¹æ³•åˆ—è¡¨

#### RoomManager.swift
1. `uploadItem()` - `Result<Void, RoomError>`
2. `startAuction()` - `Result<Void, RoomError>`
3. `placeBid()` - `Result<Void, RoomError>`
4. `endAuction()` - `Result<Void, RoomError>`
5. `applyForMicrophone()` - `Result<Int, RoomError>`
6. `leaveMicrophone()` - `Result<Void, RoomError>`
7. `kickFromMicrophone()` - `Result<Void, RoomError>`
8. `sendMessage()` - `Result<Void, RoomError>`
9. `sendVoice()` - `Result<Void, RoomError>`

## ğŸ¯ é”™è¯¯åˆ†ç±»è¯´æ˜

### 1. PermissionDeniedï¼ˆæƒé™è¢«æ‹’ç»ï¼‰
ç”¨äºæƒé™æ£€æŸ¥å¤±è´¥çš„æƒ…å†µ

**ç¤ºä¾‹**ï¼š
```swift
.permissionDenied("âŒ åªæœ‰æˆ¿ä¸»å¯ä»¥å¼€å§‹æ‹å–")
.permissionDenied("âŒ è§‚ä¼—æ— æ³•å‡ºä»·ï¼Œè¯·å‡çº§ä¸ºç«æ‹è€…")
```

### 2. OperationFailedï¼ˆæ“ä½œå¤±è´¥ï¼‰
ç”¨äºä¸šåŠ¡é€»è¾‘æ‰§è¡Œå¤±è´¥çš„æƒ…å†µ

**ç¤ºä¾‹**ï¼š
```swift
.operationFailed("ä¸Šä¼ å¤±è´¥")
.operationFailed("æ²¡æœ‰å¯ç”¨éº¦ä½")
```

### 3. InvalidStateï¼ˆæ— æ•ˆçŠ¶æ€ï¼‰
ç”¨äºçŠ¶æ€ä¸æ­£ç¡®çš„æƒ…å†µ

**ç¤ºä¾‹**ï¼š
```swift
.invalidState("æ‚¨ä¸åœ¨éº¦ä½ä¸Š")
.invalidState("æ‹å–è¿˜æœªå¼€å§‹")
```

### 4. InvalidInputï¼ˆæ— æ•ˆè¾“å…¥ï¼‰
ç”¨äºè¾“å…¥å‚æ•°ä¸æ­£ç¡®çš„æƒ…å†µï¼ˆé¢„ç•™ï¼‰

**ç¤ºä¾‹**ï¼š
```swift
.invalidInput("å‡ºä»·é‡‘é¢æ— æ•ˆ")
```

## âœ¨ ä¿®æ”¹å¸¦æ¥çš„å¥½å¤„

### 1. ç±»å‹å®‰å…¨
- ç¬¦åˆSwiftçš„ç±»å‹ç³»ç»Ÿè¦æ±‚
- ç¼–è¯‘æ—¶å°±èƒ½å‘ç°é”™è¯¯ç±»å‹é—®é¢˜

### 2. é”™è¯¯åˆ†ç±»
- å°†é”™è¯¯æŒ‰ç±»å‹åˆ†ç±»ï¼Œä¾¿äºå¤„ç†
- å¯ä»¥é’ˆå¯¹ä¸åŒç±»å‹çš„é”™è¯¯åšä¸åŒçš„å¤„ç†

### 3. å¯æ‰©å±•æ€§
- å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„é”™è¯¯ç±»å‹
- å¯ä»¥ä¸ºæ¯ç§é”™è¯¯æ·»åŠ é¢å¤–çš„ä¿¡æ¯

### 4. ä¸€è‡´æ€§
- æ•´ä¸ªé¡¹ç›®ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯ç±»å‹
- é”™è¯¯å¤„ç†æ–¹å¼ä¸€è‡´

## ğŸ” ä½¿ç”¨ç¤ºä¾‹

### å®šä¹‰é”™è¯¯
```swift
enum RoomError: Error {
    case permissionDenied(String)
    case operationFailed(String)
}
```

### è¿”å›é”™è¯¯
```swift
func placeBid(...) -> Result<Void, RoomError> {
    guard hasPermission else {
        return .failure(.permissionDenied("æƒé™ä¸è¶³"))
    }
    
    guard success else {
        return .failure(.operationFailed("å‡ºä»·å¤±è´¥"))
    }
    
    return .success(())
}
```

### å¤„ç†é”™è¯¯
```swift
let result = manager.placeBid(...)

switch result {
case .success:
    print("æˆåŠŸ")
case .failure(let error):
    print(error.localizedDescription)
    
    // ä¹Ÿå¯ä»¥æ ¹æ®é”™è¯¯ç±»å‹åšä¸åŒå¤„ç†
    switch error {
    case .permissionDenied(let message):
        showPermissionAlert(message)
    case .operationFailed(let message):
        showErrorAlert(message)
    default:
        break
    }
}
```

## ğŸ“ æ£€æŸ¥æ¸…å•

- âœ… åˆ›å»ºäº† RoomError æšä¸¾ç±»å‹
- âœ… ä¿®æ”¹äº†æ‰€æœ‰ Result çš„è¿”å›ç±»å‹
- âœ… ä¿®æ”¹äº†æ‰€æœ‰é”™è¯¯åˆ›å»ºè¯­å¥
- âœ… ä¿®æ”¹äº†æ‰€æœ‰é”™è¯¯å¤„ç†è¯­å¥
- âœ… ç¼–è¯‘é€šè¿‡ï¼Œæ— é”™è¯¯
- âœ… æµ‹è¯•ä»£ç å·²æ›´æ–°

## ğŸš€ éªŒè¯

è¿è¡Œé¡¹ç›®åï¼Œå¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°æ­£ç¡®çš„é”™è¯¯æç¤ºï¼š

```
ğŸ” æƒé™æ£€æŸ¥: [è§‚ä¼—å°æ˜] [å‡ºä»·] [æ‹å–ä¸­] -> âŒ æ‹’ç» âŒ è§‚ä¼—æ— æ³•å‡ºä»·ï¼Œè¯·å‡çº§ä¸ºç«æ‹è€…
âœ… æµ‹è¯•é€šè¿‡ï¼šâŒ è§‚ä¼—æ— æ³•å‡ºä»·ï¼Œè¯·å‡çº§ä¸ºç«æ‹è€…
```

---

**ä¿®å¤æ—¶é—´**ï¼š2025-11-21  
**çŠ¶æ€**ï¼šâœ… å®Œæˆ  
**å½±å“èŒƒå›´**ï¼š4ä¸ªæ–‡ä»¶ï¼Œçº¦50å¤„ä¿®æ”¹

