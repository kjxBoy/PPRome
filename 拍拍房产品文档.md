# 拍拍房产品设计文档

## 一、产品概述
拍拍房是一个实时拍卖房间系统，用户可以创建或加入拍卖房间，对各类物品（如手机号、虚拟物品等）进行竞价拍卖。

---

## 二、核心角色

### 1. 房主/主持人（Host）
- 创建拍卖房间
- 设置房间规则（起拍价、加价幅度、时长等）
- 管理麦位（邀请上麦、踢下麦）
- 控制拍卖流程（开始、暂停、结束）
- 默认在1号麦位
- 可语音主持拍卖
- 确认最终成交

### 2. 拍卖人（Auctioneer）
- 申请或被邀请上麦
- 上麦后介绍自己的拍卖物品
- 可语音介绍物品详情、回答问题
- 设置自己物品的起拍价和规则
- 确认最终成交

### 3. 竞拍者（Bidder）
- 浏览并加入拍卖房间
- 查看拍卖物品详情
- 出价竞拍
- 麦下用户通过文字消息互动
- 可申请上麦（需房主同意）

### 4. 观众（Viewer）
- 观看拍卖过程
- 查看实时出价信息
- 发送文字消息
- 无出价权限

---

## 三、麦位系统

### 麦位布局
```
房间支持N个麦位（如6个或8个）

麦位1（固定）：房主/主持人
麦位2-N：拍卖人或其他用户
```

### 麦位状态
- **空闲**：麦位无人，显示"空麦"
- **占用**：有用户在麦上
- **锁定**：房主锁定该麦位，无法上麦
- **禁言**：在麦上但被禁言

### 上麦方式
1. **申请上麦**
   - 用户点击空闲麦位发起申请
   - 房主收到申请通知
   - 房主同意后用户上麦

2. **邀请上麦**
   - 房主点击用户头像
   - 选择"邀请上麦"
   - 用户同意后上麦

3. **房主抱麦**
   - 房主直接将用户移动到指定麦位

### 下麦方式
- 用户主动下麦
- 房主踢下麦
- 切换拍卖人时自动下麦

### 麦位权限

| 角色 | 语音 | 文字消息 | 控制流程 | 出价权限 |
|------|------|----------|----------|----------|
| 房主（麦上） | ✅ 可说话 | ✅ 可发送 | ✅ 完全控制 | ✅ 可出价 |
| 拍卖人（麦上） | ✅ 可说话 | ✅ 可发送 | ⚙️ 管理自己拍品 | ❌ 不可出价自己拍品 |
| 竞拍者（麦上） | ✅ 可说话 | ✅ 可发送 | ❌ 无权限 | ✅ 可出价 |
| 竞拍者（麦下） | ❌ 不可说话 | ✅ 可发送 | ❌ 无权限 | ✅ 可出价 |
| 观众（麦下） | ❌ 不可说话 | ✅ 可发送 | ❌ 无权限 | ❌ 不可出价 |

### 麦位交互细节

**语音质量保障：**
- 采样率：48kHz
- 编码：Opus
- 降噪：开启
- 回声消除：开启
- 自动增益控制：开启

**麦位UI展示：**
- 正在说话：头像外圈动态波形
- 静音状态：显示静音图标
- 网络状态：显示信号强度
- 角色标识：房主、拍卖人徽章

**上麦申请管理：**
- 申请列表按时间排序
- 房主可批量同意/拒绝
- 申请超时自动取消（60秒）
- 麦位满时自动排队

---

## 四、房间状态流转

```
准备阶段 → 上拍 → 拍卖中 → 定拍
```

### 1. 准备阶段（Preparing）
**描述：** 房间创建后，拍卖人上麦准备介绍物品

**功能：**
- 房主（主持人）在1号麦位
- 拍卖人申请或被邀请上麦（2号麦位）
- 拍卖人上传拍卖物品信息
- 拍卖人设置拍卖规则（起拍价、加价幅度、倒计时时长）
- 拍卖人可通过语音介绍物品
- 其他用户加入房间，在公屏发文字消息互动
- 房主和拍卖人可语音交流

**麦位状态：**
- 麦位1：房主（主持人）
- 麦位2：拍卖人（介绍物品）
- 麦位3-N：空闲或其他用户

**角色权限：**
- 房主：管理麦位、语音主持、开始拍卖
- 拍卖人：语音介绍物品、设置规则
- 竞拍者（麦下）：查看物品信息、发文字消息、等待开始
- 观众：查看物品信息、发文字消息

**状态转换：**
- 房主点击"开始拍卖" → 进入"上拍"

---

### 2. 上拍（Listing）
**描述：** 正式展示拍卖物品，拍卖人最后介绍，给竞拍者准备时间

**功能：**
- 大屏展示拍卖物品详情
- 显示起拍价和规则
- 拍卖人语音进行最后介绍（如："这个手机号尾号8888，起拍价100元"）
- 房主语音主持（如："大家准备好，马上开拍"）
- 倒计时准备（如10秒倒计时）
- 竞拍者在公屏发消息互动

**麦位状态：**
- 麦位1：房主（语音主持）
- 麦位2：拍卖人（语音介绍）
- 其他麦位：可有其他用户在麦上交流

**角色权限：**
- 房主：语音主持、查看参与人数、可提前开始
- 拍卖人：语音最后介绍
- 竞拍者（麦上）：可语音交流
- 竞拍者（麦下）：发文字消息、准备出价
- 观众：查看物品信息、发文字消息

**状态转换：**
- 倒计时结束或房主点击"立即开始" → 进入"拍卖中"

---

### 3. 拍卖中（Auctioning）
**描述：** 正式竞价阶段，实时出价竞拍，房主和拍卖人语音渲染气氛

**功能：**
- 实时显示当前最高价和出价人
- 竞拍者快速出价（加价按钮）
- 出价历史滚动展示
- 拍卖倒计时（有人出价时重置）
- 语音/动画提示新出价
- 房主语音渲染气氛（如："200元！还有没有更高的？"）
- 拍卖人可语音回应（如："感谢这位老板出价"）
- 竞拍者在公屏刷消息互动

**麦位状态：**
- 麦位1：房主（语音主持拍卖）
- 麦位2：拍卖人（语音互动）
- 其他麦位：可有其他用户在麦上交流

**角色权限：**
- 房主：语音主持、监控拍卖进程、可提前结束
- 拍卖人：语音互动、查看实时出价
- 竞拍者（麦上）：可语音交流、出价竞拍
- 竞拍者（麦下）：发文字消息、出价竞拍、查看排名
- 观众：观看实时竞拍、发文字消息

**核心规则：**
- 每次出价必须 ≥ 当前价 + 加价幅度
- 有新出价时，倒计时重置（如重置为30秒）
- 房主可语音播报："还剩10秒，最后机会！"
- 倒计时归零且无新出价 → 进入"定拍"

**状态转换：**
- 倒计时结束且无新出价 → 进入"定拍"
- 房主语音宣布"成交！" → 进入"定拍"

---

### 4. 定拍（Closed）
**描述：** 拍卖结束，确认成交

**功能：**
- 展示最终成交价和获胜者
- 庆祝动画（成交提示）
- 房主语音宣布："恭喜XX以XX元成交！"
- 拍卖人语音感谢
- 生成交易订单
- 公屏显示成交信息

**麦位状态：**
- 麦位1：房主（语音宣布成交）
- 麦位2：拍卖人（语音感谢）
- 其他麦位：可邀请获胜者上麦庆祝

**角色权限：**
- 房主：语音宣布成交、确认交付、开启下一轮
- 拍卖人：确认成交、联系获胜者、语音感谢
- 竞拍者（获胜）：查看成交信息、完成支付、可上麦发言
- 竞拍者（未中）：查看最终结果、发文字消息
- 观众：查看成交结果、发文字消息

**后续操作：**
- 生成交易记录
- 拍卖人与获胜者私聊交付
- 房主可开启下一轮拍卖（邀请下一个拍卖人上麦）
- 当前拍卖人下麦，下一个拍卖人上麦 → 回到"准备阶段"
- 用户可退出房间

---

## 五、房间信息结构

```json
{
  "roomId": "房间唯一ID",
  "roomName": "拍卖房间名称",
  "owner": {
    "userId": "房主ID",
    "nickname": "房主昵称",
    "avatar": "头像URL"
  },
  "status": "preparing | listing | auctioning | closed",
  
  "microphones": [
    {
      "seatNumber": 1,
      "status": "occupied",
      "user": {
        "userId": "房主ID",
        "nickname": "主持人",
        "avatar": "头像URL",
        "role": "host"
      },
      "isMuted": false,
      "isLocked": true
    },
    {
      "seatNumber": 2,
      "status": "occupied",
      "user": {
        "userId": "拍卖人ID",
        "nickname": "拍卖人昵称",
        "avatar": "头像URL",
        "role": "auctioneer"
      },
      "isMuted": false,
      "isLocked": false
    },
    {
      "seatNumber": 3,
      "status": "empty",
      "user": null,
      "isMuted": false,
      "isLocked": false
    }
  ],
  
  "currentAuctioneer": {
    "userId": "拍卖人ID",
    "nickname": "拍卖人昵称",
    "avatar": "头像URL"
  },
  
  "item": {
    "type": "phone_number | virtual_item | other",
    "name": "物品名称",
    "description": "物品描述",
    "images": ["图片URL数组"],
    "auctioneerId": "拍卖人ID"
  },
  
  "rules": {
    "startPrice": 100,
    "incrementStep": 10,
    "countdownSeconds": 30
  },
  
  "currentBid": {
    "price": 150,
    "bidderId": "出价人ID",
    "bidderName": "出价人昵称",
    "timestamp": "出价时间"
  },
  
  "participants": {
    "onMicrophone": ["麦上用户列表"],
    "bidders": ["竞拍者列表"],
    "viewers": ["观众列表"],
    "total": 50
  },
  
  "bidHistory": ["出价历史记录"],
  
  "messages": [
    {
      "messageId": "消息ID",
      "userId": "用户ID",
      "nickname": "用户昵称",
      "content": "消息内容",
      "type": "text | bid | system",
      "timestamp": "时间戳"
    }
  ],
  
  "createdAt": "创建时间",
  "startedAt": "开始时间",
  "endedAt": "结束时间"
}
```

---

## 六、核心功能模块

### 1. 房间大厅
- 展示所有进行中的房间
- 显示房间热度（在线人数）
- 显示当前拍卖物品和价格
- 筛选（准备中、进行中）
- 快速加入房间

### 2. 创建房间
- 填写房间信息（房间名称、简介）
- 设置麦位数量（6个或8个）
- 创建并进入房间（自动占据1号麦位）

### 3. 麦位管理（房主功能）
- 查看麦位状态
- 处理上麦申请
- 邀请用户上麦
- 将用户踢下麦
- 锁定/解锁麦位
- 禁言/解除禁言

### 4. 上麦交互
- **申请上麦**：用户点击空麦位申请
- **上麦后**：
  - 自动开启麦克风（可手动静音）
  - 实时语音通话
  - 头像高亮显示
  - 语音波形动画
- **下麦**：主动下麦或被踢下麦

### 5. 拍卖人功能
- 申请成为拍卖人（上麦）
- 上传拍卖物品信息
- 设置拍卖规则
- 语音介绍物品
- 查看实时出价
- 确认成交

### 6. 房间内实时交互
- **语音交互**：麦上用户实时语音通话
- **文字消息**：
  - 所有用户可发文字消息
  - 公屏滚动展示
  - 系统消息提示（上麦、下麦、出价）
- **WebSocket实时通信**
- **在线人数显示**

### 7. 出价操作
- 快速加价按钮（+10, +50, +100）
- 自定义出价输入
- 出价确认提示
- 出价成功语音提示
- 公屏显示出价消息

### 8. 交易管理
- 成交记录
- 支付流程
- 拍卖人与获胜者私聊
- 物品交付确认

---

## 七、页面结构

```
拍拍房App
├── 首页
│   ├── 房间大厅（列表）
│   │   ├── 房间卡片
│   │   │   ├── 房间名称
│   │   │   ├── 当前拍品
│   │   │   ├── 在线人数
│   │   │   └── 房间状态
│   │   └── 筛选标签
│   ├── 我的房间
│   └── 创建房间按钮
│
├── 拍卖房间页
│   ├── 顶部信息栏
│   │   ├── 房间名称
│   │   ├── 在线人数
│   │   ├── 房间ID
│   │   └── 退出按钮
│   │
│   ├── 麦位区域（核心区域）
│   │   ├── 麦位布局（2行3列 或 2行4列）
│   │   │   ├── 麦位1：房主（主持人）
│   │   │   │   ├── 用户头像
│   │   │   │   ├── 昵称
│   │   │   │   ├── 角色标识（主持人）
│   │   │   │   ├── 语音波形动画
│   │   │   │   └── 静音图标
│   │   │   │
│   │   │   ├── 麦位2：拍卖人
│   │   │   │   ├── 用户头像
│   │   │   │   ├── 昵称
│   │   │   │   ├── 角色标识（拍卖人）
│   │   │   │   ├── 语音波形动画
│   │   │   │   └── 静音图标
│   │   │   │
│   │   │   └── 麦位3-N：空麦或其他用户
│   │   │       ├── 空麦状态：显示"点击上麦"
│   │   │       ├── 锁定状态：显示锁图标
│   │   │       └── 占用状态：显示用户信息
│   │   │
│   │   └── 麦位操作
│   │       ├── 点击空麦：申请上麦
│   │       ├── 点击自己：下麦选项
│   │       ├── 房主点击他人：管理菜单
│   │
│   ├── 物品展示区
│   │   ├── 物品图片轮播
│   │   ├── 物品名称
│   │   ├── 物品描述
│   │   ├── 拍卖人信息
│   │   └── 拍卖规则
│   │
│   ├── 竞拍信息区
│   │   ├── 拍卖状态标识
│   │   ├── 当前价格（大字显示）
│   │   ├── 当前领先者（头像+昵称）
│   │   ├── 倒计时（圆形进度条）
│   │   └── 出价历史（滚动列表）
│   │
│   ├── 消息公屏区
│   │   ├── 消息列表（滚动）
│   │   │   ├── 文字消息
│   │   │   ├── 出价消息（高亮）
│   │   │   └── 系统消息（如：XX上麦了）
│   │   └── 消息输入框
│   │
│   └── 底部操作区
│       ├── 出价按钮（竞拍者）
│       │   ├── 快速加价（+10, +50, +100）
│       │   └── 自定义出价
│       ├── 控制按钮（房主）
│       │   ├── 开始拍卖
│       │   ├── 结束拍卖
│       │   └── 麦位管理
│       ├── 拍卖人控制（拍卖人）
│       │   ├── 上传物品
│       │   └── 设置规则
│       └── 通用按钮
│           ├── 发消息
│           ├── 静音/取消静音（麦上用户）
│           └── 更多菜单
│
└── 个人中心
    ├── 我的竞拍
    │   ├── 竞拍中
    │   ├── 已中拍
    │   └── 未中拍
    ├── 我的拍卖
    │   ├── 拍卖中
    │   ├── 已成交
    │   └── 待交付
    ├── 我的房间
    └── 交易记录
```

---

## 八、技术要点

### 实时语音通信
- WebRTC音频通话
- 麦位用户实时语音
- 语音编解码优化
- 降噪和回声消除
- 低延迟传输（<200ms）

### 实时消息通信
- WebSocket连接保持房间实时状态
- 出价、状态变更即时推送
- 文字消息实时分发
- 断线重连机制
- 消息队列保证顺序

### 麦位管理
- 麦位状态实时同步
- 上麦申请队列管理
- 语音状态监控
- 自动降麦机制（网络中断）

### 状态同步
- 服务端为权威状态
- 客户端定时同步校验
- 防止并发出价冲突
- 麦位状态强一致性

### 性能优化
- 房间人数上限控制（如500人）
- 麦位数量限制（6-8个）
- 出价防抖处理
- 历史记录分页加载
- 语音流优化（仅麦上用户）

---

## 九、使用流程示例

### 房主（主持人）流程
1. 点击"创建房间"
2. 填写房间名称（如："今晚靓号专场"）
3. 点击"创建"→ 自动进入房间并占据1号麦位
4. 语音宣布："欢迎来到拍拍房，今晚有很多好货"
5. 等待拍卖人申请上麦
6. 同意拍卖人上麦申请（拍卖人进入2号麦位）
7. 拍卖人上传物品并设置规则 → **准备阶段**
8. 与拍卖人语音互动，了解物品信息
9. 点击"开始拍卖"→ **上拍**（10秒倒计时）
10. 语音主持："大家准备好，马上开拍！"
11. 自动进入 **拍卖中**
12. 语音渲染气氛："200元！还有没有更高的？最后10秒！"
13. 30秒无人出价后自动 **定拍**
14. 语音宣布："恭喜XX以300元成交！"
15. 邀请下一个拍卖人上麦，开启下一轮

### 拍卖人流程
1. 进入房间
2. 点击2号麦位申请上麦
3. 房主同意后上麦
4. 点击"上传拍卖物品"
5. 填写物品信息（如：靓号手机号 13888888888）
6. 设置起拍价100元、每次加价≥10元
7. 语音介绍："各位老板好，我这个号尾号8888，非常吉利"→ **准备阶段**
8. 房主点击"开始拍卖"→ **上拍**
9. 语音最后介绍："起拍价100，有意向的老板可以出价了"
10. 进入 **拍卖中**，关注出价情况
11. 语音互动："感谢这位老板出价"
12. 进入 **定拍**，语音感谢："感谢各位老板，恭喜XX"
13. 私聊获胜者，完成交易
14. 下麦，让出位置

### 竞拍者流程
1. 浏览房间大厅
2. 点击感兴趣的房间加入
3. 看到麦位区域，房主和拍卖人在麦上语音聊天
4. 听拍卖人介绍物品（或看公屏文字）
5. 在公屏发消息："这个号不错"
6. （可选）申请上麦与拍卖人语音交流
7. 等待"上拍"倒计时
8. 进入"拍卖中"后快速出价："150元"
9. 在公屏看到自己出价消息高亮显示
10. 听到房主语音："有人出150了！"
11. 看到别人出价200，继续出价220
12. 实时查看自己是否领先
13. 若获胜进入"定拍"，房主语音恭喜
14. 完成支付，与拍卖人私聊交付

### 观众流程
1. 进入房间观看
2. 听麦上用户语音交流
3. 在公屏发消息互动
4. 观看整个拍卖过程
5. 看到成交结果

---

## 十、扩展功能（可选）

### 基础扩展
- 🎁 **保证金机制**：竞拍者需缴纳保证金，防恶意出价
- 🏆 **竞拍排行榜**：展示活跃竞拍者、成交金额排行
- 📢 **拍卖提醒通知**：关注的拍卖即将开始时推送
- 📊 **个人数据统计**：竞拍次数、成交率、总金额
- 🎨 **房间主题装扮**：自定义房间背景、麦位样式

### 社交功能
- 👥 **关注拍卖人**：关注喜欢的拍卖人，获取动态
- 💬 **私聊功能**：用户间私聊沟通
- 🎖️ **用户等级徽章**：根据活跃度显示等级
- ⭐ **评价系统**：对拍卖人和物品评价

### 麦位增强
- 🎤 **麦位特效**：语音时的炫酷特效
- 🎵 **背景音乐**：房间背景音乐（可调节音量）
- 🔇 **全体禁言**：房主一键禁止公屏发言
- 👏 **虚拟礼物**：送礼物给麦上用户

### 拍卖玩法
- ⏱️ **快拍模式**：倒计时更短，节奏更快
- 🎯 **一口价**：设置一口价直接成交
- 📦 **盲拍模式**：部分信息隐藏，增加神秘感
- 🔥 **连拍模式**：一次拍多个相似物品

### 运营功能
- 📊 **数据看板**：房主查看房间数据
- 💰 **平台抽成**：每笔交易平台抽成比例
- 🎫 **房间门票**：进入房间需购买门票
- 🏅 **认证拍卖人**：平台认证的优质拍卖人

---

## 十一、核心指标

### 房间相关
- 日均房间创建数
- 活跃房间数
- 平均单房间参与人数
- 平均单房间在线时长
- 房间满座率（麦位占用率）

### 用户相关
- 日活跃用户数（DAU）
- 日活跃房主数
- 日活跃拍卖人数
- 日活跃竞拍者数
- 平均上麦时长
- 用户留存率（次日/7日/30日）

### 交易相关
- 日均拍卖物品数
- 成交率（成交数/上拍数）
- 平均成交价
- 平均加价次数
- 总成交金额（GMV）
- 平台收入

### 互动相关
- 平均语音时长
- 公屏消息发送量
- 上麦申请通过率
- 平均单场拍卖时长

### 体验相关
- 语音连接成功率
- 平均语音延迟
- WebSocket连接稳定性
- 用户投诉率

---

## 十二、交互流程图

```
用户进入房间
    ↓
查看麦位区域（房主在1号麦，可能有拍卖人在2号麦）
    ↓
听语音 或 看公屏文字
    ↓
[想上麦交流] → 点击空麦位申请 → 等待房主同意 → 上麦语音
    ↓                                            ↓
[想拍卖物品] ← ← ← ← ← ← ← ← ← ← ← ← ← ← ← ← ← ← 
    ↓
上传物品信息并设置规则（准备阶段）
    ↓
房主点击"开始拍卖"
    ↓
上拍（10秒倒计时，拍卖人最后介绍）
    ↓
拍卖中（用户出价，房主语音渲染）
    ↓
定拍（房主语音宣布成交）
    ↓
拍卖人与获胜者私聊交付
    ↓
拍卖人下麦，下一个拍卖人上麦
    ↓
循环往复
```

---

**版本：** v2.0（增加麦位+语音交互）  
**更新日期：** 2025-11-21  
**设计师：** AI Assistant

